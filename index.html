function playFullArticle() {
    console.log('尝试播放全篇音频...');
    // 显示加载提示
    const loadingIndicator = document.createElement('div');
    loadingIndicator.textContent = '正在加载音频，请稍候...';
    loadingIndicator.style.position = 'fixed';
    loadingIndicator.style.top = '50%';
    loadingIndicator.style.left = '50%';
    loadingIndicator.style.transform = 'translate(-50%, -50%)';
    loadingIndicator.style.background = 'rgba(0, 0, 0, 0.7)';
    loadingIndicator.style.color = 'white';
    loadingIndicator.style.padding = '10px 20px';
    loadingIndicator.style.borderRadius = '5px';
    loadingIndicator.style.zIndex = '1000';
    document.body.appendChild(loadingIndicator);

    // 停止并重置所有音频
    fullAudio.pause();
    fullAudio.currentTime = 0;
    segmentAudio.pause();
    segmentAudio.currentTime = 0;

    fullAudio.src = 'audio/full_article.mp3';
    fullAudio.load();
    console.log('全篇音频源设置为:', fullAudio.src);

    // 监听音频加载完成事件
    fullAudio.addEventListener('canplay', function onCanPlay() {
        fullAudio.removeEventListener('canplay', onCanPlay);
        document.body.removeChild(loadingIndicator); // 移除加载提示
        fullAudio.play()
            .then(() => {
                console.log('全篇音频播放成功');
                isAudioPlaying = true;
                setTimeout(() => {
                    if (isAudioPlaying) {
                        document.addEventListener('click', stopAudioOnClick);
                    }
                }, 500);
            })
            .catch(error => {
                console.error('全篇音频播放失败:', error);
                alert('无法播放课文音频，请检查音频文件路径或浏览器权限设置。\n错误: ' + error.message);
            });
    }, { once: true });

    // 监听加载错误
    fullAudio.addEventListener('error', function onError() {
        console.error('全篇音频加载失败:', fullAudio.error);
        document.body.removeChild(loadingIndicator); // 移除加载提示
        alert('全篇音频加载失败，请检查音频文件是否存在。\n错误: ' + fullAudio.error.message);
    }, { once: true });
}

function playSegment(articleId) {
    console.log('尝试播放分段音频，articleId:', articleId);
    const segment = articleSegments.find(seg => seg.articleId === articleId);
    if (!segment) {
        console.error('未找到对应 articleId 的段落:', articleId);
        return;
    }

    // 显示加载提示
    const loadingIndicator = document.createElement('div');
    loadingIndicator.textContent = '正在加载音频，请稍候...';
    loadingIndicator.style.position = 'fixed';
    loadingIndicator.style.top = '50%';
    loadingIndicator.style.left = '50%';
    loadingIndicator.style.transform = 'translate(-50%, -50%)';
    loadingIndicator.style.background = 'rgba(0, 0, 0, 0.7)';
    loadingIndicator.style.color = 'white';
    loadingIndicator.style.padding = '10px 20px';
    loadingIndicator.style.borderRadius = '5px';
    loadingIndicator.style.zIndex = '1000';
    document.body.appendChild(loadingIndicator);

    // 停止并重置全篇音频
    fullAudio.pause();
    fullAudio.currentTime = 0;
    console.log('全篇音频已停止以播放分段音频');

    // 移除之前的点击停止监听
    document.removeEventListener('click', stopAudioOnClick);

    // 移除之前的高亮
    if (currentHighlightedSegment) {
        currentHighlightedSegment.classList.remove('highlight');
    }

    // 设置并高亮当前段落
    const newHighlightedSegment = articleContent.querySelector(`.segment[data-article-id="${articleId}"]`);
    if (newHighlightedSegment) {
        newHighlightedSegment.classList.add('highlight');
        currentHighlightedSegment = newHighlightedSegment;
    } else {
        console.error('未找到对应 DOM 元素:', articleId);
    }

    // 播放分段音频
    segmentAudio.src = segment.audio;
    segmentAudio.load();
    console.log('分段音频源设置为:', segmentAudio.src);

    // 监听音频加载完成事件
    segmentAudio.addEventListener('canplay', function onCanPlay() {
        segmentAudio.removeEventListener('canplay', onCanPlay);
        document.body.removeChild(loadingIndicator); // 移除加载提示
        segmentAudio.play()
            .then(() => {
                console.log('分段音频播放成功:', segment.audio);
                isAudioPlaying = true;
                // 音频播放结束时移除高亮
                segmentAudio.onended = () => {
                    newHighlightedSegment.classList.remove('highlight');
                    currentHighlightedSegment = null;
                    isAudioPlaying = false;
                };
            })
            .catch(error => {
                console.error('分段音频播放失败:', error);
                if (error.message.includes('interrupted by a call to pause')) {
                    console.warn('播放被中断，正在重试...');
                    segmentAudio.play();
                } else {
                    alert('无法播放分段音频，请检查音频文件或网络连接。\n错误: ' + error.message);
                }
            });
    }, { once: true });

    // 监听加载错误
    segmentAudio.addEventListener('error', function onError() {
        console.error('分段音频加载失败:', segmentAudio.error);
        document.body.removeChild(loadingIndicator); // 移除加载提示
        alert('分段音频加载失败，请检查音频文件是否存在。\n错误: ' + segmentAudio.error.message);
    }, { once: true });
}
